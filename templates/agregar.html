{% extends "layout.html" %}
{% block title %}Agregar Producto{% endblock %}
{% block content %}
<h2>Agregar Producto</h2>

<form method="post">
    <div class="mb-3">
        <label class="form-label">Nombre</label>
        <input type="text" name="nombre" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Cantidad</label>
        <input type="number" name="cantidad" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Stock Mínimo</label>
        <input type="number" name="stock_minimo" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Precio de Costo</label>
        <div class="input-group">
            <span class="input-group-text">$</span>
            <input type="text" name="precio_costo" id="precio_costo" class="form-control" required>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">% Ganancia</label>
        <input type="text" name="ganancia" id="ganancia" class="form-control">
    </div>

    <div class="mb-3">
        <label class="form-label">Precio de Venta (Calculado)</label>
        <div class="input-group">
            <span class="input-group-text">$</span>
            <input type="text" id="precio_venta" class="form-control" readonly>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Proveedor</label>
        <input type="text" name="proveedor" class="form-control">
    </div>

    <button type="submit" class="btn btn-success">➕ Agregar</button>
    <a href="{{ url_for('inventario') }}" class="btn btn-secondary">Cancelar</a>
</form>

<script>
// ✅ Conversión robusta de números (soporta formatos es-AR e inglés)
function parsearNumero(valor) {
    if (!valor) return NaN;
    valor = valor.toString().trim();
    if (/^\d+(\.\d+)?$/.test(valor)) {
        return parseFloat(valor);
    }
    return parseFloat(valor.replace(/\./g, "").replace(",", "."));
}

// ✅ Calcular precio de venta dinámicamente
function calcularPrecioVenta() {
    let costo = parsearNumero(document.getElementById("precio_costo").value);
    let ganancia = parsearNumero(document.getElementById("ganancia").value);

    if (!isNaN(costo) && !isNaN(ganancia)) {
        let precioVenta = costo * (1 + (ganancia / 100));
        document.getElementById("precio_venta").value =
            precioVenta.toLocaleString("es-AR", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    } else {
        document.getElementById("precio_venta").value = "";
    }
}

// ✅ Eventos para recalcular automáticamente
document.getElementById("precio_costo").addEventListener("input", calcularPrecioVenta);
document.getElementById("ganancia").addEventListener("input", calcularPrecioVenta);
</script>
{% endblock %}
